{% extends "base.html" %}

{% block logo %}<a href="{{ url_for('events.home') }}" class="logo back-link" id="back-link">&larr; All Events</a>{% endblock %}

{% block content %}
<div class="sticky-controls">
<div class="header-row">
    <h1>Guest Database</h1>
    <div class="btn-group">
        <button type="button" class="btn" id="open-add-guest-btn"><span class="btn-label-short">+</span><span class="btn-label-full">+ Add New Guest</span></button>
        <button type="button" class="icon-btn" id="toggle-filters-btn" title="Filters">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" y1="6" x2="20" y2="6"/><line x1="8" y1="12" x2="16" y2="12"/><line x1="11" y1="18" x2="13" y2="18"/></svg>
        </button>
        <div class="kebab-wrapper">
            <button type="button" class="icon-btn" id="page-menu-btn" aria-label="More">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
            </button>
            <div class="kebab-menu kebab-menu-right" id="page-menu">
                <div class="kebab-menu-search">
                    <input type="search" id="guest-search" placeholder="Search guests...">
                </div>
                <a href="{{ url_for('exports.export_guests') }}">Export to Excel</a>
            </div>
        </div>
    </div>
</div>

{% if guests %}
<div class="table-controls" id="event-filters" style="display:none">
    <select class="filter-select" id="guest-gender-filter">
        <option value="">All Genders</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
    </select>
    <select class="filter-select" id="guest-sort">
        <option value="created-desc">Last Created</option>
        <option value="first-asc">First Name (A-Z)</option>
        <option value="last-asc">Last Name (A-Z)</option>
        <option value="gender-asc">Gender</option>
    </select>
</div>
{% endif %}
</div>

{% if guests %}
<table id="guests-table" class="sortable" data-page="{{ pagination.page }}" data-pages="{{ pagination.pages }}">
    <thead>
        <tr>
            <th data-sort="text">First Name</th>
            <th data-sort="text">Last Name</th>
            <th data-sort="text">Gender</th>
            <th data-sort="text" class="col-hide-mobile">Guest Notes</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% include "partials/guest_rows.html" %}
    </tbody>
</table>

<p class="empty" id="no-results" style="display:none;">No guests match your filters.</p>

<div class="scroll-loader" id="scroll-loader" style="display:none">
    <div class="scroll-spinner"></div>
</div>
{% else %}
<p class="empty">No guests yet. Add your first guest!</p>
{% endif %}

<!-- Add New Guests modal (same as event page) -->
<div class="detail-overlay" id="add-guest-overlay" style="display:none">
    <div class="detail-card guest-db-card">
        <div class="detail-card-header">
            <span class="modal-title">Add New Guests</span>
            <button type="button" class="detail-close" id="add-guest-close">&times;</button>
        </div>
        <div class="add-guest-table-wrapper">
            <table class="add-guest-table" id="add-guest-table">
                <thead>
                    <tr>
                        <th>First Name</th>
                        <th>Last Name</th>
                        <th>Gender</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="add-guest-tbody">
                </tbody>
            </table>
        </div>
        <div class="guest-db-footer">
            <span class="modal-hint">Press Enter to add another guest</span>
            <button type="button" class="btn" id="add-guest-save-btn">Save</button>
        </div>
    </div>
</div>

<!-- Guest Detail overlay -->
<div class="detail-overlay" id="guest-detail-overlay" style="display:none">
    <div class="detail-card">
        <div class="detail-card-header">
            <span class="modal-title">Guest Detail</span>
            <button type="button" class="detail-close" id="guest-detail-close">&times;</button>
        </div>
        <div class="detail-card-body">
            <form class="form modal-form" id="guest-detail-form">
                <input type="hidden" id="gd-guest-id">
                <div class="form-row">
                    <div class="form-field">
                        <label for="gd-first">First Name</label>
                        <input type="text" id="gd-first" required>
                    </div>
                    <div class="form-field">
                        <label for="gd-last">Last Name</label>
                        <input type="text" id="gd-last">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label for="gd-gender">Gender</label>
                        <select id="gd-gender">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </div>
                    <div class="form-field">
                        <label>This is me</label>
                        <label class="ios-toggle">
                            <input type="checkbox" id="gd-is-me">
                            <span class="ios-toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label for="gd-notes">Notes</label>
                        <textarea id="gd-notes" rows="3" placeholder="Add notes about guest"></textarea>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn">Save</button>
                </div>
            </form>
            <div class="guest-detail-meta" id="gd-meta"></div>
        </div>
    </div>
</div>
{% endblock %}
